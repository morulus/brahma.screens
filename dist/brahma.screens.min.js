/*!
* brahma.screens 1.2.6 (* 20-03-2015)
* Prallax fullscreen slider
* https://github.com/morulus/brahma.screens

* Released under the MIT license 
* Copyright (c) 2015, Vladimir Kalmykov (@morulus) <vladimirmorulus@gmail.com> 
*/
!function($$){$$.app("screens",{config:{infinity:!1,lockDelay:!1,easing:"cubic-bezier(.43,.2,.46,.8)",duration:650,infinityMethod:"passage",touch:!0,autoFillImages:!0,deadlockEffect:!0,keyboard:!0,mobileMap:!1,debug:!1},data:{currentScreen:[0,0],shift:{x:0,y:0},advshift:{x:0,y:0},moving:0,movingStartTime:0,movingEndTime:0,maxX:0,maxY:0,minX:0,minY:0,locks:!1,colorTheme:""},modules:{},effects:{},grid:[],portalGrid:[],htmlelements:{},run:function(){function createSvgSprite(){var svg=document.createElementNS("http://www.w3.org/2000/svg","svg");Brahma(this)[0].appendChild(svg);var use=document.createElementNS("http://www.w3.org/2000/svg","use");use.setAttributeNS("http://www.w3.org/1999/xlink","href","#yo-a"),svg.appendChild(use)}var that=this;Brahma(this.selector).find(">*").wrapAll("div",{}),this.htmlelements.screensWrapper=Brahma(this.selector).find(">div"),Brahma(this.selector).addClass("brahma-widgets-screens"),Brahma(this.htmlelements.screensWrapper).find(">*").each(function(){var element=this;if(that.config.autoFillImages&&"img"===Brahma(element)[0].tagName.toLowerCase()){var src=Brahma(element).attr("src"),alt=Brahma(element).attr("alt")||src.replace("\\","/").split("/").reverse()[0];element=Brahma(element).replace(document.createElement("DIV"),!0).css({"background-image":'url("'+src+'")'}),Brahma(element).put("div",{"class":"brahma-widgets-screens-label"}).html(alt)}var xy=that.reserveCell(parseInt(Brahma(element).data("screens-x")),parseInt(Brahma(element).data("screens-y")),{node:element,colorTheme:Brahma(element).data("screens-color-theme")||!1});Brahma(element).css({left:100*xy[0]+"%",top:100*xy[1]+"%"}),Brahma(element).hasClass("current")&&(that.data.currentScreen=xy)});var arrowSpriteId="screens-sprite-arrow",defssvg=document.createElementNS("http://www.w3.org/2000/svg","svg");document.getElementsByTagName("body")[0].appendChild(defssvg),defssvg.innerHTML='<g id="yo-a"><path  d="M13.849,54.143l3.182,2.784l26.819-28.368L16.962,0.249l-3.206,2.989l24.17,25.388L13.849,54.143z"/></g>',this.htmlelements.navigation=Brahma(this.selector).tie(function(){Brahma(this).put("div",{"class":"dharma-widgets-screens-navigation dharma-widgets-screens-navigation-up"}).tie(function(){that.htmlelements.navigation_up=this,createSvgSprite.call(this,"#"+arrowSpriteId),Brahma(this).bind("click",function(){that.up()})}).and("div",{"class":"dharma-widgets-screens-navigation dharma-widgets-screens-navigation-down"}).tie(function(){that.htmlelements.navigation_down=this,createSvgSprite.call(this,"#"+arrowSpriteId),Brahma(this).bind("click",function(){that.down()})}).and("div",{"class":"dharma-widgets-screens-navigation dharma-widgets-screens-navigation-left"}).tie(function(){that.htmlelements.navigation_left=this,createSvgSprite.call(this,"#"+arrowSpriteId),Brahma(this).bind("click",function(){that.left()})}).and("div",{"class":"dharma-widgets-screens-navigation dharma-widgets-screens-navigation-right"}).tie(function(){that.htmlelements.navigation_right=this,createSvgSprite.call(this,"#"+arrowSpriteId),Brahma(this).bind("click",function(){that.right()})})}),this.htmlelements.map=Brahma(this.selector).put("div",{"class":"dharma-widgets-screens-map"}),this.rebuildMap(),Brahma(this.htmlelements.screensWrapper).css(["-webkit-","-ms-","-o-","-moz-"],{"transition-duration":this.config.duration+"ms"}),Brahma(this.htmlelements.screensWrapper).css(["-webkit-","-ms-","-o-","-moz-"],{"transition-timing-function":this.config.easing}),this.config.keyboard&&this.module("keylistner").run(),this.config.infinity&&this.module("infinity").run(),this.config.touch&&this.module("touch"),Brahma.caniuse("mobile")&&this.config.mobileMap&&this.module("mobileMap"),this["goto"](this.data.currentScreen,!0),Brahma(this.selector).css("opacity","1")},up:function(){if(!this.canIMove())return!1;switch(this.canIMoveUp()){case!1:return this.module("edgeEffect").up();case 2:this.trigger("beforeMove",["up"]),this.modules.infinity.portalMove("up");break;case!0:this.trigger("beforeMove",["up"]),this["goto"]([this.data.currentScreen[0],this.data.currentScreen[1]-1])}},down:function(){if(!this.canIMove())return!1;switch(this.canIMoveDown()){case!1:return this.module("edgeEffect").down();case 2:this.trigger("beforeMove",["down"]),this.modules.infinity.portalMove("down");break;case!0:this.trigger("beforeMove",["down"]),this["goto"]([this.data.currentScreen[0],this.data.currentScreen[1]+1])}},left:function(){if(!this.canIMove())return!1;switch(this.canIMoveLeft()){case!1:return this.module("edgeEffect").left();case 2:this.trigger("beforeMove",["left"]),this.modules.infinity.portalMove("left");break;case!0:this.trigger("beforeMove",["left"]),this["goto"]([this.data.currentScreen[0]-1,this.data.currentScreen[1]])}},right:function(){if(!this.canIMove())return!1;switch(this.canIMoveRight()){case!1:return this.module("edgeEffect").right();case 2:this.trigger("beforeMove",["right"]),this.modules.infinity.portalMove("right");break;case!0:this.trigger("beforeMove",["right"]),this["goto"]([this.data.currentScreen[0]+1,this.data.currentScreen[1]])}},rebuildMap:function(){Brahma(this.htmlelements.map).empty();for(var that=this,y=0;y<this.grid.length;y++)"undefined"!=typeof this.grid[y]&&function(wrapper,layer){for(var x=0;x<layer.length;x++)!function(x,y){Brahma(wrapper).put("div",{"class":"screen-box-"+("undefined"==typeof layer[x]?"empty":"item"),"data-coords":y+"x"+x}).bind("click",function(){Brahma(this).hasClass("screen-box-item")&&that["goto"]([x,y])})}(x,y)}.call(this,Brahma(this.htmlelements.map).put("div",{"class":"screen-box-layer"}),this.grid[y])},navigationHide:function(thing){switch(thing){case"up":Brahma(this.htmlelements.navigation_up).addClass("hidden");break;case"down":Brahma(this.htmlelements.navigation_down).addClass("hidden");break;case"left":Brahma(this.htmlelements.navigation_left).addClass("hidden");break;case"right":Brahma(this.htmlelements.navigation_right).addClass("hidden")}},navigationShow:function(thing){switch(thing){case"up":Brahma(this.htmlelements.navigation_up).removeClass("hidden");break;case"down":Brahma(this.htmlelements.navigation_down).removeClass("hidden");break;case"left":Brahma(this.htmlelements.navigation_left).removeClass("hidden");break;case"right":Brahma(this.htmlelements.navigation_right).removeClass("hidden")}},getRealUpSlide:function(){switch(this.config.infinityMethod){case"passage":if(1===this.grid.length)return!1;if(this.config.infinity&&0===this.data.currentScreen[1]&&this.grid[this.data.maxY][this.data.currentScreen[0]])return 2;if(this.grid[this.data.currentScreen[1]-1]&&this.grid[this.data.currentScreen[1]-1][this.data.currentScreen[0]])break}},canIMoveUp:function(){return 1===this.grid.length?!1:this.config.infinity&&("discover"===this.config.infinityMethod&&(!this.grid[this.data.currentScreen[1]-1]||!this.grid[this.data.currentScreen[1]-1][this.data.currentScreen[0]])||0===this.data.currentScreen[1]&&this.grid[this.data.maxY][this.data.currentScreen[0]])?2:this.grid[this.data.currentScreen[1]-1]&&this.grid[this.data.currentScreen[1]-1][this.data.currentScreen[0]]?!0:!1},canIMoveDown:function(){return 1===this.grid.length?!1:this.config.infinity&&("discover"===this.config.infinityMethod&&(!this.grid[this.data.currentScreen[1]+1]||!this.grid[this.data.currentScreen[1]+1][this.data.currentScreen[0]])||this.data.currentScreen[1]===this.grid.length-1&&this.grid[0][this.data.currentScreen[0]])?2:this.grid[this.data.currentScreen[1]+1]&&this.grid[this.data.currentScreen[1]+1][this.data.currentScreen[0]]?!0:!1},canIMoveLeft:function(){return this.config.infinity&&"discover"===this.config.infinityMethod||1!==this.grid[this.data.currentScreen[1]].length?!this.grid[this.data.currentScreen[1]][this.data.currentScreen[0]-1]&&this.config.infinity&&("discover"===this.config.infinityMethod&&this.grid.length>1||0===this.data.currentScreen[0]&&this.grid[this.data.currentScreen[1]][this.data.maxX])?2:this.grid[this.data.currentScreen[1]][this.data.currentScreen[0]-1]?!0:!1:!1},canIMoveRight:function(){return this.config.infinity&&"discover"===this.config.infinityMethod||1!==this.grid[this.data.currentScreen[1]].length?!this.grid[this.data.currentScreen[1]][this.data.currentScreen[0]+1]&&this.config.infinity&&("discover"===this.config.infinityMethod&&this.grid.length>1||this.data.currentScreen[0]===this.grid[this.data.currentScreen[1]].length-1&&this.grid[this.data.currentScreen[1]][this.data.minX])?2:this.grid[this.data.currentScreen[1]][this.data.currentScreen[0]+1]?!0:!1:!1},canIMove:function(){return this.data.locks?!1:this.config.lockDelay===!0?this.data.moving?!1:!0:"number"==typeof this.config.lockDelay&&this.data.moving&&(new Date).getTime()-this.data.movingStartTime<this.config.lockDelay?!1:!0},getFirstXSlideByY:function(y){if(!this.grid[y])return!1;for(var x=0;x<this.grid[y].length;x++)if(this.grid[y][x])return x;return!1},getLastXSlideByY:function(y){if(!this.grid[y])return!1;for(var x=this.grid[y].length-1;x>=0;x--)if(this.grid[y][x])return x;return!1},getFirstYSlideByX:function(x){for(var y=0;y<this.grid.length;y++)if(this.grid[y]&&this.grid[y][x])return y;return!1},getLastYSlideByX:function(x){for(var y=this.grid.length-1;y>=0;y--)if(this.grid[y]&&this.grid[y][x])return y;return!1},shiftScreen:function(x,y,callback){var callback=callback||!1;Brahma(this.htmlelements.screensWrapper).css({top:-100*y+"%",left:-100*x+"%"}),"function"==typeof callback&&callback()},translate:function(x,y){var polytransform=["-webkit-","-ms-","-o-"],transform=Brahma.caniuse("translate3D")?"translate3D("+(x+100*this.data.shift.x+this.data.advshift.x)+"%,"+(y+100*this.data.shift.y+this.data.advshift.y)+"%,0)":"translateX("+(x+100*this.data.shift.x+this.data.advshift.x)+"%) translateY("+(y+100*this.data.shift.y+this.data.advshift.y)+"%)";Brahma(this.htmlelements.screensWrapper).css(polytransform,{"animation-play-state":"paused"}),Brahma(this.htmlelements.screensWrapper).css(polytransform,{transform:transform})},moveScreen:function(x,y,immediately,callback){var callback=callback||!1;if(immediately){Brahma(this.htmlelements.screensWrapper).addClass("noTransit");var that=this}var absx=-1*x,absy=-1*y;this.translate(100*absx,100*absy),immediately?setTimeout(function(){Brahma(that.htmlelements.screensWrapper).removeClass("noTransit"),"function"==typeof callback&&callback()},10):setTimeout(function(){"function"==typeof callback&&callback()},this.config.duration)},"goto":function(xy,immediately){if(!this.canIMove())return!1;this.data.currentScreen=xy,Brahma(this.htmlelements.screensWrapper).find(">*").removeClass("current"),Brahma(this.grid[xy[1]][xy[0]].node).addClass("current");var x=xy[0],y=xy[1];this.data.movingStartTime=(new Date).getTime(),this.data.moving++;var that=this;this.trigger("movingStart"),setTimeout(function(){that.grid[xy[1]][xy[0]].colorTheme!==that.data.colorTheme&&(Brahma(that.htmlelements.navigation_up).removeClass(that.data.colorTheme),Brahma(that.htmlelements.navigation_down).removeClass(that.data.colorTheme),Brahma(that.htmlelements.navigation_left).removeClass(that.data.colorTheme),Brahma(that.htmlelements.navigation_right).removeClass(that.data.colorTheme)),that.grid[xy[1]][xy[0]].colorTheme?(that.data.colorTheme=that.grid[xy[1]][xy[0]].colorTheme,Brahma(that.htmlelements.navigation_up).addClass(that.grid[xy[1]][xy[0]].colorTheme),Brahma(that.htmlelements.navigation_down).addClass(that.grid[xy[1]][xy[0]].colorTheme),Brahma(that.htmlelements.navigation_left).addClass(that.grid[xy[1]][xy[0]].colorTheme),Brahma(that.htmlelements.navigation_right).addClass(that.grid[xy[1]][xy[0]].colorTheme)):that.data.colorTheme=""},this.config.duration/2),this.moveScreen(x,y,immediately||!1,function(){that.data.movingEndTime=(new Date).getTime(),that.data.moving--,that.trigger("movingEnd")}),this.canIMoveUp()?this.navigationShow("up"):this.navigationHide("up"),this.canIMoveDown()?this.navigationShow("down"):this.navigationHide("down"),this.canIMoveLeft()?this.navigationShow("left"):this.navigationHide("left"),this.canIMoveRight()?this.navigationShow("right"):this.navigationHide("right"),Brahma(this.htmlelements.map).find(">div>div").removeClass("current"),Brahma(this.htmlelements.map).find("div[data-coords="+y+"x"+x+"]").addClass("current")},reserveCell:function(x,y,data){if("undefined"!=typeof this.grid[y]&&"undefined"!=typeof this.grid[y][x])var xy=function(ox,oy){for(var y=0;y<this.grid.length;y++){if("undefined"==typeof this.grid[y])return[0,y];for(var x=0;x<this.grid[y].length;x++)if("undefined"==typeof this.grid[y][x])return[x,y]}return[ox,oy]}.call(this,x,y),x=xy[x],y=xy[y];return"undefined"==typeof this.grid[y]&&(this.grid[y]=[]),this.grid[y][x]=Brahma.copyProps({active:Brahma(data.node).hasClass("screen-box-item"),colorTheme:!1,onVisible:[]},data),this.trigger("gridAdds",[this.grid[y][x]]),y>this.data.maxY&&(this.data.maxY=y),x>this.data.maxX&&(this.data.maxX=x),x<this.data.minX&&(this.data.minX=x),y<this.data.minY&&(this.data.minY=y),[x,y]}})}(Brahma),Brahma.app("screens").module("touch",function(){this.listner=Brahma(this.master.selector[0]).app("touch",{simpleMoves:!0,minMoveX:30,minMoveY:30,preventDefaultEvents:!1});var that=this;this.listner.bind("swipeLeft",function(){that.master.right()}),this.listner.bind("swipeRight",function(){that.master.left()}),this.listner.bind("swipeUp",function(){that.master.down()}),this.listner.bind("swipeDown",function(){that.master.up()})},{listner:null}),Brahma.app("screens").module("keylistner",{run:function(){var that=this;Brahma(document).bind("keydown",function(e){switch(that.master.trigger("keydown",[e]),e.which){case 38:that.master.up();break;case 40:that.master.down();break;case 37:that.master.left();break;case 39:that.master.right()}})}}),Brahma.app("screens").module("preloader",{loadings:0,loadImage:function(src,first){var img=new Image,that=this;img.onload=img.onerror=function(){that.loaded()},img.src=src,first&&this.master.trigger("firstimginit",[img])},loaded:function(){this.loadings--,0===this.loadings&&this.done()},done:function(){Brahma(this.master.meta.slides[0].node).css("position","absolute"),this.master.module("slideshow").resume()},run:function(){this.master.module("slideshow").pause();for(var i=1;i<this.master.meta.slides.length;i++)Brahma(this.master.meta.slides[i].node).css("opacity",0);Brahma(this.master.meta.slides[0].node).css("position","static"),this.master.config.adjustContainerHeight&&Brahma(this.master.selector).css({height:"auto"}),this.loadings=0;for(var images=[],that=this,i=0;i<this.master.meta.slides.length;i++)Brahma(this.master.meta.slides[i].node).is("img")?(images.push(Brahma(this.master.meta.slides[i].node).attr("src")),that.loadings++):Brahma(this.master.meta.slides[i].node).find("img").each(function(){images.push(Brahma(this).attr("src")),that.loadings++});for(var i=0;i<images.length;i++)this.loadImage(images[i],0===i)}}),Brahma.app("screens").module("edgeEffect",{mod:function(coord,direct){if(!this.master.config.deadlockEffect||this.master.data.moving)return!1;this.master.data.advshift[coord]=25*direct,this.master.translate(-100*this.master.data.currentScreen[0],-100*this.master.data.currentScreen[1]);var that=this;return setTimeout(function(){that.master.data.advshift[coord]=0,that.master.translate(-100*that.master.data.currentScreen[0],-100*that.master.data.currentScreen[1])},100),!1},up:function(){return this.mod("y",1)},down:function(){return this.mod("y",-1)},left:function(){return this.mod("x",1)},right:function(){return this.mod("x",-1)}}),Brahma.app("screens").module("mobileMap",function(){var that=this;Brahma(this.master.htmlelements.map).addClass("mobile"),this.master.bind("movingStart",function(){that.zoomMap()}),this.master.bind("movingEnd",function(){that.tryUnZoomMap()})},{zoomMap:function(){Brahma(this.master.htmlelements.map).addClass("visible")},tryUnZoomMap:function(){var that=this;setTimeout(function(){that.master.data.moving||that.unZoomMap()},150)},unZoomMap:function(){Brahma(this.master.htmlelements.map).removeClass("visible")}}),Brahma.app("screens").module("location",{},function(){}),Brahma.app("screens").module("infinity",{run:function(){this.master.htmlelements.phantom=!1,this.master.config.lockDelay===!1&&(this.master.config.lockDelay=!0)},portalMove:function(direction){var fakex,fakey,nextx,nexty;switch(direction){case"up":switch(this.master.config.infinityMethod){case"discover":fakey=this.master.getLastYSlideByX(this.master.data.currentScreen[0])+1,fakex=this.master.data.currentScreen[0],nexty=fakey-1,nextx=fakex;break;case"passage":fakey=this.master.grid.length,fakex=this.master.data.currentScreen[0],nexty=fakey-1,nextx=fakex}break;case"down":switch(this.master.config.infinityMethod){case"discover":fakey=this.master.getFirstYSlideByX(this.master.data.currentScreen[0])-1,fakex=this.master.data.currentScreen[0],nexty=fakey+1,nextx=fakex;break;case"passage":fakey=-1,fakex=this.master.data.currentScreen[0],nexty=0,nextx=fakex}break;case"left":switch(this.master.config.infinityMethod){case"discover":var nexty=this.master.data.currentScreen[1],nextx=!1,protect=66;do if(nexty<this.master.data.minY?nexty=this.master.data.maxY:nexty--,nextx=this.master.getLastXSlideByY(nexty),protect--,0>protect)return void alert("fuuuuck");while(nextx===!1);fakey=nexty,fakex=nextx+1,nexty=nexty,nextx=fakex-1;break;case"passage":fakey=this.master.data.currentScreen[1],fakex=this.master.grid[this.master.data.currentScreen[0]].length,nexty=0,nextx=fakex-1}break;case"right":switch(this.master.config.infinityMethod){case"discover":var nexty=this.master.data.currentScreen[1],nextx=!1,protect=66;do if(nexty>this.master.data.maxY?nexty=this.master.data.minY:nexty++,nextx=this.master.getFirstXSlideByY(nexty),protect--,0>protect)return void alert("fuuuuck");while(nextx===!1);fakey=nexty,fakex=nextx-1,nexty=nexty,nextx=fakex+1;break;case"passage":fakey=this.master.data.currentScreen[1],fakex=0,nexty=0,nextx=fakex+1}}this.master.portalGrid[fakex]&&this.master.portalGrid[fakex][fakey]?this.master.portalGrid[fakex][fakey].processed:this.createFakeSlide(fakex,fakey);var that=this;this.master.data.shift.x+=fakex-this.master.data.currentScreen[0],this.master.data.shift.y+=fakey-this.master.data.currentScreen[1],this.master.shiftScreen(this.master.data.shift.x,this.master.data.shift.y,function(){that.master["goto"]([nextx,nexty],!1,function(){that.master.portalGrid[fakex][fakey].processed=!1})})},createFakeSlide:function(fakex,fakey){"object"!=typeof this.master.portalGrid[fakex]&&(this.master.portalGrid[fakex]={}),this.master.portalGrid[fakex][fakey]={node:Brahma(this.master.htmlelements.screensWrapper).put(Brahma(this.master.grid[this.master.data.currentScreen[1]][this.master.data.currentScreen[0]].node).clone()).css({left:100*fakex+"%",top:100*fakey+"%"}).addClass("fake"),processed:!0}}});
//# sourceMappingURL=brahma.screens.min.js.map